---
show: step
version: 1.0
enable_checker: true
---
# tinyCoroLab2a: æ„å»ºä»»åŠ¡æ‰§è¡Œå¼•æ“engine

## tinyCoroLab2aå®éªŒç®€ä»‹

æœ¬èŠ‚æˆ‘ä»¬å°†æ­£å¼å¼€å§‹tinyCoroLab2aï¼Œå³æ„å»ºä»»åŠ¡æ‰§è¡Œå¼•æ“çš„å­æ¨¡å—engineã€‚tinyCoroçš„æ‰§è¡Œå¼•æ“æ˜¯ç”±contextå’Œengineä¸¤éƒ¨åˆ†ç»„æˆçš„ï¼Œengineä½œä¸ºæ‰§è¡Œå¼•æ“çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œè´Ÿè´£å­˜å‚¨å¹¶æ‰§è¡Œæ‰€æœ‰taskä»¥åŠå¼‚æ­¥I/Oï¼Œå› æ­¤è¦æƒ³è®©tinyCoroçœŸæ­£å¯¹å¤–æä¾›æœåŠ¡çš„ç¬¬ä¸€æ­¥ä¾¿æ˜¯å®Œæˆengineçš„å®ç°ã€‚

> ğŸ’¡**æ€ä¹ˆå»ç†è§£contextå’Œengineï¼Ÿ**
> è¿™é‡Œåšä¸€ä¸ªæ¯”å–»ï¼ŒæŠŠæ‰§è¡Œå¼•æ“çœ‹åšæˆ˜åœºçš„å£«å…µï¼Œtaskæ˜¯å¾…æ‰§è¡Œçš„ä»»åŠ¡ï¼Œé‚£ä¹ˆengineä¾¿æ˜¯å£«å…µæ‰‹é‡Œçš„æ­¦å™¨ï¼Œcontextåˆ™æ˜¯å£«å…µæœ¬äººï¼Œä¸€ä¸ªå£«å…µé…å¤‡ä¸€æŠŠæ­¦å™¨ï¼Œåªæœ‰è£…å¤‡äº†æ­¦å™¨çš„å£«å…µæ‰èƒ½å»æ‰§è¡Œä»»åŠ¡ï¼Œè€Œåç»­çš„schedulerå¯ä»¥çœ‹ä½œæ˜¯å¸ä»¤å®˜ï¼Œè´Ÿè´£æ”¶é›†å£«å…µä¼ é€’çš„æƒ…æŠ¥å¹¶å‘å£«å…µæ´¾å‘ä»»åŠ¡ã€‚

#### é¢„å¤‡çŸ¥è¯†

> âš ï¸é¢„å¤‡çŸ¥è¯†å³åœ¨å®éªŒå¼€å§‹å‰ä½ åº”è¯¥å·²ç»æŒæ¡çš„çŸ¥è¯†ï¼Œä¸”åœ¨[çŸ¥è¯†é“ºå«ç« èŠ‚]()ä¸­å‡æœ‰æ¶‰åŠ

- **io_uringçš„æ¦‚å¿µä»¥åŠliburingçš„ä½¿ç”¨**
- **eventfdçš„æ¦‚å¿µåŠä½¿ç”¨**
- **C++åç¨‹å¥æŸ„çš„ä½¿ç”¨**

## ğŸ“–lab2aä»»åŠ¡ä¹¦

### å®éªŒå‰ç½®è®²è§£

æœ¬èŠ‚å®éªŒæ¶‰åŠåˆ°çš„æ ¸å¿ƒæ–‡ä»¶ä¸º[include/coro/engine.hpp](https://github.com/sakurs2/tinyCoroLab/blob/master/include/coro/engine.hpp)å’Œ[src/engine.cpp](https://github.com/sakurs2/tinyCoroLab/blob/master/src/engine.cpp)ï¼Œå®éªŒè€…éœ€è¦é¢„å…ˆæ‰“å¼€æ–‡ä»¶æµè§ˆå¤§è‡´ä»£ç ç»“æ„ï¼Œä¸‹é¢é’ˆå¯¹è¯¥æ–‡ä»¶å†…å®¹è¿›è¡Œè®²è§£ã€‚

é¦–å…ˆæ˜¯engineçš„æˆå‘˜å˜é‡uring_proxyï¼Œæˆ‘ä»¬æ‰“å¼€å…¶æ‰€åœ¨æ–‡ä»¶[include/coro/uring_proxy.hpp](https://github.com/sakurs2/tinyCoroLab/blob/master/include/coro/uring_proxy.hpp)ï¼Œè¯¥æ–‡ä»¶æœ¬è´¨ä¸Šæ˜¯å¯¹liburingçš„äºŒæ¬¡å°è£…ï¼Œè¯»è€…åº”è¯¥äº†è§£è¿‡ä»£ç†æ¨¡å¼ï¼Œé€šè¿‡è¿™ç§æ–¹æ³•å¯ä»¥é™ä½liburingä¸tinyCoroä¹‹é—´çš„è€¦åˆæ€§å¹¶ç®€åŒ–liburingçš„ä½¿ç”¨ã€‚å®éªŒè€…å¯ä»¥é˜…è¯»æ³¨é‡Šæ¥ç†è§£uring_proxyå„ä¸ªæ–¹æ³•çš„åŠŸèƒ½ï¼Œå¹¶ä¸”å¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œæ‹“å±•ã€‚uring_proxyä½¿ç”¨çš„io_uringæ˜¯ä¸eventfdç»‘å®šçš„ï¼Œè™½ç„¶åœ¨çŸ¥è¯†é“ºå«ç« èŠ‚å·²ç»è®²è¿‡äºŒè€…ä¹‹é—´çš„æ­é…ï¼Œä½†è¿™é‡Œè¿˜æ˜¯è¦é‡ç‚¹å¼ºè°ƒä¸€ä¸‹ï¼š**ä»eventfdè¯»å–çš„å€¼å¹¶ä¸èƒ½åæ˜ å·²å®Œæˆçš„I/Oæ•°é‡ï¼Œåªèƒ½è¡¨ç¤ºæœ‰å·²å®Œæˆçš„I/O**ï¼Œå…·ä½“åŸå› å·²åœ¨[çŸ¥è¯†é“ºå«ç« èŠ‚]()è®²è¿‡ã€‚

ç„¶åæ˜¯engineå­˜å‚¨taskçš„æ•°æ®ç»“æ„`m_task_queue`ï¼Œå…·ä½“å­˜å‚¨å•å…ƒä¸ºåç¨‹å¥æŸ„ã€‚taskæ˜¯ç”±engineè‡ªèº«æ¶ˆè´¹çš„ï¼Œä½†taskçš„ç”Ÿäº§å¯èƒ½æ¥è‡ªåˆ«çš„çº¿ç¨‹ï¼Œå› æ­¤å¯ä»¥çœ‹ä½œå•æ¶ˆè´¹è€…å¤š-ç”Ÿäº§è€…æ¨¡å‹ï¼Œengineé»˜è®¤é€‰ç”¨ç¬¬ä¸‰æ–¹åº“[atomic_queue](https://github.com/max0x7ba/atomic_queue)æä¾›çš„ä¸€ä¸ªé«˜æ€§èƒ½çš„å¤šç”Ÿäº§è€…-å¤šæ¶ˆè´¹è€…æ— é”ç¯å½¢ç¼“å†²é˜Ÿåˆ—ï¼Œé˜Ÿåˆ—çš„å¤§å°ç”±tinyCoroçš„é…ç½®å‚æ•°å†³å®šï¼Œå½“ç„¶å®éªŒè€…ä¹Ÿå¯ä»¥æ›¿æ¢ä¸ºåˆ«çš„æ•°æ®ç»“æ„ã€‚

> ğŸ’¡**å¦‚ä½•engineçš„ä»»åŠ¡é˜Ÿåˆ—å·²æ»¡ï¼Œä¸”æ­¤æ—¶è‡ªèº«å·¥ä½œçº¿ç¨‹å‘è‡ªèº«æ´¾å‘ä»»åŠ¡ï¼Œä¼šä¸ä¼šå¯¼è‡´æ°¸ä¹…æ€§é˜»å¡ï¼Ÿ**
> ä¼šçš„ï¼ŒtinyCoroåœ¨1.1ç‰ˆæœ¬ä¿®å¤äº†è¯¥é—®é¢˜ï¼Œä½†å®éªŒæš‚ä¸å¼ºåˆ¶å®éªŒè€…è§£å†³è¯¥é—®é¢˜ï¼Œæµ‹è¯•ä¹Ÿæš‚ä¸æ¶‰åŠ

å…¶æ¬¡æ˜¯engineç”¨æ¥å­˜å‚¨io_uring cqeçš„æ•°ç»„`m_urc`ï¼Œåœ¨æ‰¹é‡ä»io_uringå–å‡ºcqeçš„æ—¶å€™éœ€è¦ç”¨åˆ°ã€‚

å…³äºengineçš„å…¶å®ƒæ¥å£å‡æœ‰æ³¨é‡Šä¸”åœ¨å…·ä½“ä»»åŠ¡ä¹¦ä¸­ä¼šè¯¦ç»†è®²è§£ï¼Œä¸‹å›¾æ˜¯engineä¸å¤–éƒ¨äº¤äº’çš„é€»è¾‘å›¾ï¼Œè¯»è€…å¯åœ¨æ¥ä¸‹æ¥çš„å…·ä½“ä»»åŠ¡ä¹¦ä¸­ç»“åˆè¯¥å›¾æ¥ç†è§£ã€‚

![engine_core](./sources/ch07_lab2a_p1.png)

### âš ï¸æ³¨æ„äº‹é¡¹

- è¯·ç¡®ä¿å·²é˜…è¯»è¿‡**tinyCoroLab Introduce**ç« èŠ‚ã€‚
- ä¸ºäº†ç¡®ä¿æ­£ç¡®å®ç°ç›®æ ‡å‡½æ•°ï¼Œå®éªŒè€…å¯èƒ½éœ€è¦åšä¸€äº›é¢å¤–æ“ä½œï¼šæ–°å¢ç±»ã€ä¿®æ”¹ç°æœ‰ç±»çš„å®ç°ã€è¡¥å……ç°æœ‰ç±»çš„æ–¹æ³•å’Œæˆå‘˜å˜é‡ç­‰æ“ä½œï¼Œè¯·éµå¾ª**free-designå®éªŒåŸåˆ™**ã€‚
- ä½ éœ€è¦ä»”ç»†è¯„ä¼°å¾…å®ç°çš„æ¥å£æ˜¯å¦éœ€è¦æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚
- ä»»ä½•å¯¼è‡´æµ‹è¯•å¡ä½ã€å´©æºƒç­‰æ— æ³•ä½¿æµ‹è¯•é¡ºåˆ©é€šè¿‡çš„æƒ…å†µéƒ½è¡¨æ˜ä½ çš„ä»£ç å­˜åœ¨é—®é¢˜ã€‚

### å®éªŒä»»åŠ¡ä¹¦

#### ğŸ§‘â€ğŸ’»Task #1 - å®Œå–„engineåˆå§‹åŒ–ä»¥åŠå¼‚æ­¥I/Oæ”¯æŒ

##### ä»»åŠ¡ç›®æ ‡

å¯¹äºengineçš„åˆå§‹åŒ–ä¸ææ„æ˜¯é€šè¿‡è°ƒç”¨`init()`å’Œ`deinit()`æˆå‘˜å‡½æ•°å®ç°çš„ï¼Œå®éªŒè€…éœ€è¦è‡ªè¡Œå®Œå–„è¿™éƒ¨åˆ†é€»è¾‘æ¥ç¡®ä¿èµ„æºçš„æ­£ç¡®åˆå§‹åŒ–ä¸é‡Šæ”¾ï¼Œä»»ä½•éœ€è¦è¢«initæˆ–è€…deinitçš„æˆå‘˜å˜é‡å‡åº”è¯¥è¢«æ­£ç¡®å¤„ç†ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯åœ¨å®éªŒä»‹ç»ç« èŠ‚æåˆ°[include/coro/meta_info.hpp](https://github.com/sakurs2/tinyCoroLab/blob/master/include/coro/meta_info.hpp)æ–‡ä»¶å­˜å‚¨äº†çº¿ç¨‹å±€éƒ¨å˜é‡ä½œä¸ºåç¨‹è¿è¡Œçš„ä¸Šä¸‹æ–‡ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š

```cpp
struct CORO_ALIGN local_info
{
    context* ctx{nullptr};
    engine*  egn{nullptr};
};
inline thread_local local_info linfo;
```

è¿™é‡Œç”¨thread_localé™å®šçš„`linfo`å³çº¿ç¨‹å±€éƒ¨å˜é‡ï¼Œå®éªŒè€…åº”å½“åœ¨`init()`å‡½æ•°å¯¹`egn`è¿›è¡Œèµ‹å€¼æ¥ä½¿å¾—åç¨‹åœ¨è¿è¡Œæ—¶å¯ä»¥é€šè¿‡`local_engine()`è·å–å½“å‰çº¿ç¨‹ç»‘å®šçš„engineã€‚

ä»engineäº¤äº’é€»è¾‘å›¾ä¸­æˆ‘ä»¬ä¸éš¾çœ‹å‡ºå¤–éƒ¨æƒ³è¦æ‰§è¡Œå¼‚æ­¥I/Oéœ€è¦è°ƒç”¨`get_free_urs()`è·å–sqeåå†è°ƒç”¨`add_io_submit()`å‘Šè¯‰engineåˆšåˆšæ–°æ·»åŠ äº†ä¸€ä¸ªI/Oä»»åŠ¡ç­‰å¾…è¢«æäº¤ï¼Œå› æ­¤ä½ åº”è¯¥åœ¨engineå†…éƒ¨æ–°å¢å˜é‡æ¥å­˜å‚¨å¾…æäº¤çš„I/Oæ•°ï¼Œè‡³äºengineå¦‚ä½•æ‰§è¡ŒI/Oä¼šåœ¨æ¥ä¸‹æ¥çš„Taskä¸­æ¶‰åŠã€‚

##### æ¶‰åŠæ–‡ä»¶

- [include/coro/engine.hpp](https://github.com/sakurs2/tinyCoroLab/blob/master/include/coro/engine.hpp)
- [src/engine.cpp](https://github.com/sakurs2/tinyCoroLab/blob/master/src/engine.cpp)

##### å¾…å®ç°å‡½æ•°

- `coro::detail::engine::init()`
- `coro::detail::engine::deinit()`
- `coro::detail::engine::get_free_urs()`
- `coro::detail::engine::add_io_submit()`

#### è¡¥å……è¯´æ˜

æäº¤I/Oçš„çº¿ç¨‹å¯èƒ½éå½“å‰çº¿ç¨‹ï¼Œå› æ­¤ä½ éœ€è¦ç¡®ä¿æ•´ä¸ªlab2aä¸­å…³äºIOè¿è¡ŒçŠ¶æ€çš„å¤„ç†æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œè‡³äºliburingå…¶æœ¬èº«å®ç°å°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚

#### ğŸ§‘â€ğŸ’»Task #2 - å®Œå–„engineä»»åŠ¡æ‰§è¡Œèƒ½åŠ›

##### ä»»åŠ¡ç›®æ ‡

é¦–å…ˆæ˜¯å¯¹äºå¤–éƒ¨è°ƒç”¨engineçš„`submit_task(coroutine_handle<> handle)`æ¥æäº¤ä»»åŠ¡ï¼Œå®éªŒè€…åº”è¯¥ä¿è¯è¯¥ä»»åŠ¡ä¼šè¢«å­˜å‚¨åˆ°ä»»åŠ¡é˜Ÿåˆ—ã€‚

ç„¶åæ˜¯å¤–éƒ¨çš„å·¥ä½œçº¿ç¨‹ä¼šè°ƒç”¨engineçš„apiæ¥é©±åŠ¨engineæ‰§è¡Œä»»åŠ¡ï¼Œè¯¦æƒ…å¦‚ä¸‹ï¼š

- **`ready()`**ï¼šå·¥ä½œçº¿ç¨‹ç”¨æ¥åˆ¤æ–­engineçš„ä»»åŠ¡é˜Ÿåˆ—æ˜¯å¦è¿˜æœ‰å¾…æ‰§è¡Œçš„ä»»åŠ¡ã€‚
- **`num_task_schedule()`**ï¼šå¾—åˆ°å½“å‰engineçš„ä»»åŠ¡é˜Ÿåˆ—è¿˜æœ‰å¤šå°‘ä»»åŠ¡ã€‚
- **`schedule()`**ï¼šengineä¼šä»ä»»åŠ¡é˜Ÿåˆ—ä¸­å¼¹å‡ºä¸€ä¸ªä»»åŠ¡å¹¶ä½œä¸ºè¿”å›å€¼è¿”å›ï¼Œè¯¥å‡½æ•°ä¼šè¢«å·²ç»å®ç°å¥½çš„`exec_one_task()`å‡½æ•°è°ƒç”¨ã€‚
- **`empty_io()`**ï¼šå·¥ä½œçº¿ç¨‹è°ƒç”¨æ­¤å‡½æ•°æ¥åˆ¤æ–­engineå†…éƒ¨æ˜¯å¦è¿˜æœ‰æœªå¤„ç†çš„I/Oä»»åŠ¡ï¼Œè¿™åŒ…æ‹¬æœªæäº¤å’Œæ­£åœ¨æ‰§è¡Œä½†æœªå®Œæˆçš„I/Oï¼Œå› æ­¤å®éªŒè€…å¯èƒ½éœ€è¦é¢å¤–å˜é‡æ¥è®°å½•I/Oä»»åŠ¡çš„æ‰§è¡ŒçŠ¶æ€ã€‚å¦‚æœ`empty_io()`è¿”å›äº†falseé‚£ä¹ˆå³ä½¿å·¥ä½œçº¿ç¨‹æ”¶åˆ°åœæ­¢ä¿¡å·ä¹Ÿä¸ä¼šç›´æ¥åœæ­¢ï¼Œå› ä¸ºè¿™è¡¨æ˜è¿˜æœ‰ä»»åŠ¡æ²¡æœ‰æ‰§è¡Œå®Œæˆã€‚
- **`poll_submit()`**ï¼šè¿™æ˜¯engineæœ€ä¸ºæ ¸å¿ƒçš„å‡½æ•°ï¼Œå®éªŒè€…éœ€è¦åœ¨æ­¤å‡½æ•°ä¸­å®ç°å¯¹I/Oçš„æäº¤ä»¥åŠå¤„ç†å·²ç»å®Œæˆçš„I/Oï¼Œå¯¹äºä»io_uringå–å‡ºçš„cqeï¼Œå®éªŒè€…ä»…éœ€è¦å¯¹å…¶è°ƒç”¨å·²ç»å®ç°çš„`handle_cqe_entry()`å‡½æ•°å³å¯ã€‚è€Œåœ¨å¤„ç†I/Oçš„è¿‡ç¨‹ä¸­ä¹Ÿåº”è¯¥å˜æ›´
I/Oæ‰§è¡ŒçŠ¶æ€ï¼Œè¿™éƒ¨åˆ†é€»è¾‘å®éªŒè€…è‡ªè¡Œè®¾è®¡ã€‚

å¯¹äºæ ¸å¿ƒçš„`poll_submit()`å‡½æ•°ï¼Œè¿™é‡ŒåŠ¡å¿…å¼ºè°ƒä¸€ä¸‹ï¼Œå®éªŒè€…åº”è¯¥æ¸…æ¥šuring_proxyä¸­çš„io_uringæ˜¯ä¸eventfdç»‘å®šçš„ï¼Œ**ä¸ºä»€ä¹ˆè¦ç»‘å®ševentfdå‘¢ï¼Ÿå› ä¸ºå¦‚æœä¸è¿™æ ·åšï¼Œåœ¨å·¥ä½œçº¿ç¨‹æ²¡æœ‰ä»»ä½•è®¡ç®—ä»»åŠ¡å’ŒI/Oä»»åŠ¡çš„æƒ…å†µä¸‹ä¼šä¸€ç›´å¾ªç¯æ‰§è¡Œengineçš„apiï¼Œè¿™ä¼šæµªè´¹cpuèµ„æºï¼Œå› æ­¤åœ¨`poll_submit()`å‡½æ•°ä¸­åº”å½“å°è¯•å¯¹eventfdè¿›è¡Œé˜»å¡è¯»ï¼Œå¦‚æœI/Oäº‹ä»¶å®Œæˆå‘eventfdå†™å€¼åä¼šå”¤é†’å·¥ä½œçº¿ç¨‹ï¼Œæ­¤æ—¶å¤„ç†å·²å®Œæˆçš„I/Oäº‹ä»¶**ã€‚é‚£ä¹ˆé—®é¢˜åˆæ¥äº†ï¼Œä»»åŠ¡é˜Ÿåˆ—æœ‰ä»»åŠ¡ä½†æ²¡æœ‰I/Oä»»åŠ¡ï¼Œå·¥ä½œçº¿ç¨‹é‚£ä¸å°±ä¸€ç›´å¡åœ¨è¯»eventfdä¸Šäº†å—ï¼Ÿæ˜¯çš„ï¼Œå› æ­¤ä½ éœ€è¦åœ¨æ°å½“çš„æ—¶æœºå¯¹eventfdå†™å€¼æ¥è¾¾åˆ°â€œå”¤é†’â€å·¥ä½œçº¿ç¨‹çš„æ•ˆæœã€‚

å½“ç„¶ä¸Šè¿°æ˜¯æˆ‘æç¤ºç»™ä½ çš„æ€è·¯ï¼Œä½†ä¸ç®¡æ€æ ·è¯·è®°ä½ï¼Œ**å·¥ä½œçº¿ç¨‹æ˜¯é€šè¿‡å¾ªç¯è°ƒç”¨engineçš„apiæ¥é©±åŠ¨engineæ‰§è¡Œä»»åŠ¡çš„**ï¼tinyCoroå®ç°çš„å¾ªç¯æ–¹å¼æ˜¯åœ¨ä¸€ä¸ªå¾ªç¯ä¸­å…ˆå¤„ç†æ‰€æœ‰è®¡ç®—ä»»åŠ¡å†è°ƒç”¨`poll_submit()`å¤„ç†I/Oä»»åŠ¡ã€‚å®éªŒè€…å¿…é¡»ç¡®ä¿å¤–éƒ¨å·¥ä½œçº¿ç¨‹åœ¨å¾ªç¯çš„è¿‡ç¨‹ä¸­ä¸ä¼šå¡ä½ä¸”é¡ºåˆ©å¤„ç†å®Œæˆæ‰€æœ‰ä»»åŠ¡ï¼Œè¿™æ ·æ‰èƒ½åœ¨æ”¶åˆ°åœæ­¢ä¿¡å·åä¼˜é›…é€€å‡ºã€‚

> ğŸ’¡**å¯¹eventfdæ“ä½œæ¶‰åŠåˆ°ç³»ç»Ÿè°ƒç”¨ä¼šä¸ä¼šå¾ˆè€—æ—¶ï¼Ÿé˜»å¡åœ¨eventfdè¯»ä¸Šå²‚ä¸æ˜¯ä¼šé™ä½æ•ˆç‡ï¼Ÿ**
> eventfdçš„è¯»å†™éå¸¸è½»é‡åŸºæœ¬åœ¨1uså·¦å³ï¼Œé˜»å¡åœ¨eventfdè¯»è¡¨æ˜æ­¤æ—¶æ²¡æœ‰ä»»ä½•ä»»åŠ¡å¾…å¤„ç†ï¼ˆæ€ä¹ˆï¼Ÿæ²¡ä»»åŠ¡è¿˜ä¸è®©é—²ç€ğŸ˜ ï¼Ÿï¼‰ï¼Œæ­£å¥½åˆ©ç”¨é˜»å¡ä½¿å¾—å·¥ä½œçº¿ç¨‹è®©å‡ºæ‰§è¡Œæƒæ¥ç»™å…¶ä»–çº¿ç¨‹ã€‚

##### æ¶‰åŠæ–‡ä»¶

- [include/coro/engine.hpp](https://github.com/sakurs2/tinyCoroLab/blob/master/include/coro/engine.hpp)
- [src/engine.cpp](https://github.com/sakurs2/tinyCoroLab/blob/master/src/engine.cpp)

##### å¾…å®ç°å‡½æ•°

- `coro::detail::engine::submit_task(coroutine_handle<> handle)`
- `coro::detail::engine::ready()`
- `coro::detail::engine::num_task_schedule()`
- `coro::detail::engine::schedule()`
- `coro::detail::engine::empty_io()`
- `coro::detail::engine::poll_submit()`

### ğŸ”–æµ‹è¯•

#### åŠŸèƒ½æµ‹è¯•

åŠŸèƒ½æµ‹è¯•åœºæ™¯ä¸»è¦é’ˆå¯¹ï¼š

- **å•çº¿ç¨‹æ‰§è¡Œè®¡ç®—ä»»åŠ¡**
- **å•çº¿ç¨‹æ‰§è¡ŒIOä»»åŠ¡**
- **å·¥ä½œçº¿ç¨‹é©±åŠ¨ä¸‹çš„è®¡ç®—ä»»åŠ¡æ‰§è¡Œ**
- **å·¥ä½œçº¿ç¨‹é©±åŠ¨ä¸‹çš„IOä»»åŠ¡æ‰§è¡Œ**
- **å·¥ä½œçº¿ç¨‹é©±åŠ¨ä¸‹çš„æ··åˆä»»åŠ¡æ‰§è¡Œ**

â€œå·¥ä½œçº¿ç¨‹é©±åŠ¨â€è¡¨ç¤ºæµ‹è¯•ä¼šå¼€å¯é¢å¤–çš„çº¿ç¨‹å¹¶åˆ©ç”¨å¾ªç¯çš„æ–¹å¼é©±åŠ¨engineæ‰§è¡Œä»»åŠ¡ï¼Œå¯¹äºæµ‹è¯•ä¸­çš„IOä»»åŠ¡é‡‡ç”¨äº†liburingæä¾›çš„nop-ioï¼Œæäº¤åˆ°io_uringåä¼šç«‹åˆ»äº§ç”Ÿcqeã€‚

å®Œæˆæœ¬èŠ‚å®éªŒåï¼Œå®éªŒè€…è¯·åœ¨æ„å»ºç›®å½•ä¸‹æ‰§è¡Œä¸‹åˆ—æŒ‡ä»¤æ¥æ„å»ºä»¥åŠè¿è¡Œæµ‹è¯•ç¨‹åºï¼š

```shell
make build-lab2a # æ„å»º
make test-lab2a # è¿è¡Œ
```

#### å†…å­˜å®‰å…¨æµ‹è¯•

åœ¨æ„å»ºç›®å½•ä¸‹è¿è¡Œä¸‹åˆ—æŒ‡ä»¤æ¥æ‰§è¡Œå†…å­˜å®‰å…¨æµ‹è¯•ï¼š

```shell
make memtest-lab2a
```

æµ‹è¯•é€šè¿‡ä¼šæç¤ºpassï¼Œä¸é€šè¿‡ä¼šç»™å‡ºvalgrindçš„è¾“å‡ºæ–‡ä»¶ä½ç½®ï¼Œè¯·å®éªŒè€…æ ¹æ®è¯¥æ–‡ä»¶æ’æŸ¥å†…å­˜æ•…éšœã€‚
